
- name: Stampare le informazioni delle credenziali K8s
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Recupera le credenziali per l'API URL K8S
      awx.awx_credential:
        name: "CRED_TEST1"
        credential_type: "Source Control"
        inputs:
          fields:
            - id
            - name
            - inputs
      delegate_to: localhost
      register: api_credential

    - name: Recupera le credenziali per K8s Credential
      awx.awx_credential:
        name: "FF_K8s_Credential"
        credential_type: "K8s Credential"
        inputs:
          fields:
            - id
            - name
            - inputs
      delegate_to: localhost
      register: k8s_credential

    - name: Stampa API URL K8S
      debug:
        msg: "API URL K8S: {{ api_credential.inputs.fields.API_URL_K8S | default('Not provided') }}"

    - name: Stampa Verify SSL Option
      debug:
        msg: "Verify SSL Option: {{ api_credential.inputs.fields.verify_ssl }}"

    - name: Stampa User
      debug:
        msg: "User: {{ k8s_credential.inputs.fields.username | default('Not provided') }}"

    - name: Stampa Password
      debug:
        msg: "Password: {{ k8s_credential.inputs.fields.password | default('Not provided') }}"

    - name: Stampa Namespace
      debug:
        msg: "Namespace: {{ k8s_credential.inputs.fields.namespace | default('Not provided') }}"


---
- name: Creare tipo di credenziale K8s
  awx.awx.credential_type:
    name: "K8s Credential"
    kind: "cloud"
    inputs:
      fields:
        - id: "api_url_k8s"
          label: "API URL K8S"
          type: "string"
        - id: "verify_ssl"
          label: "Verify SSL Option"
          type: "boolean"
    injectors:
      env:
        CUSTOM_API_URL_K8S: "{{ api_url_k8s }}"
        CUSTOM_VERIFY_SSL: "{{ verify_ssl }}"

-------set parametri per credential_type
fields:
  - id: username
    type: string
    label: Username
  - id: password
    type: string
    label: Password
    secret: true
  - id: namespace
    type: string
    label: Namespace
required:
  - username
  - password
  - namespace

 env:
        CUSTOM_K8S_USER: "{{ user }}"
        CUSTOM_K8S_PASSWORD: "{{ password }}"
             CUSTOM_K8S_NAMESPACE: "{{ namespace }}"

  https://test-awx-aap-test.apps.okd.pecsvil.local/api/v2/tokens/




---esempio creazione  credential_type con vars
   # - name: Creare tipo di credenziale K8s Credential
    #   awx.awx.credential_type:
    #     name: "FC_K8S_TEST_play"
    #     kind: "cloud"
    #     inputs:
    #       fields:
    #         - id: "user"
    #           label: "User"
    #           type: "string"
    #         - id: "password"
    #           label: "Password"
    #           secret: true
    #           type: "string"
    #         - id: "k8s_namespace"
    #           label: "Namespace"
    #           type: "string"
    #         - id: "CUSTOM_API_URL_K8S"
    #           label: "API URL K8S"
    #           type: "string"
    #         - id: "CUSTOM_VERIFY_SSL"
    #           label: "Verify SSL"
    #           type: "boolean"
    #     validate_certs: false
    #     injectors:
    #       env:
    #         CUSTOM_K8S_USER: "{{ user }}"
    #         CUSTOM_K8S_PASSWORD: "{{ password }}"
    #         CUSTOM_K8S_NAMESPACE: "{{ k8s_namespace }}"
    #         CUSTOM_API_URL_K8S: "{{ api_url_k8s }}"
    #         CUSTOM_VERIFY_SSL: "{{ verify_ssl }}"
    #   register: k8s_credential_type
